# Telegram - бот, реализующий перенос стилей с одного изображения на другое

## Contents:

  * [Intro](#intro)

  * [Telegram-Bot](#tg-bot)
    * [Layer's description](#layers-description)
      * [Normalization](#normalization)
      * [Content Loss Layer](#content-loss-layer)
      * [Style Loss Layer](#style-loss-layer)
      
  * [Neural Net](#nn)
  
  * [Integration of the net into the bot](#integraion)
  
  * [Examples](#examples)
  
## Intro
В данном проекте реализовался Telegram - бот, который позволял бы своим пользователям на основе двух изображений: изображения стиля и изображения контента получать картинку, на котором стиль с первой картинки перенесен на вторую, и GIF - анимацию того, как исходная картинка преобразовалась.

При получения результата пользователю необходимо отправить боту две фотографии:
  * изображение со стилем может быть отправлено пользователем, а может быть выбрано из уже имеющихся в библиотеке бота стилей
  * изображение с контентом пользователь отправляет боту сам

Одни из изображений стилей, уже присутствующих в боте:



![Malevich](https://user-images.githubusercontent.com/71255336/215344498-8de4b457-3c46-4fbd-9526-c75415bfca7d.jpg)


![Van Gog](https://user-images.githubusercontent.com/71255336/215344502-7741d9d8-e931-48d7-a92f-f68fe65d77ba.jpg)


При получении двух фотографий бот обрабатывает их с помощью нейронной сети, и отправляет результат её работы обратно пользователю.
  
  
## Telegram-Bot

При написании телеграм - бота использовалась библиотека для языка Python [PyTelegramBotAPI](https://github.com/eternnoir/pyTelegramBotAPI/), которая очень хорошо адаптирована под TelegramAPI, и, по сути, является удобным инструментом для работы с Telegram. Установку данного модуля можно осуществить с помощью команды через pip:
```
$ pip install pyTelegramBotAPI
```
Сам экземпляр бота создается при помощи команды (где token - ваш TelegramAPI-токен):
```
bot = telebot.TeleBot(token, parse_mode=None)
```
После установки модуля были прописаны триггеры на такие команды, как ```/start``` и ```/help```, которые были реализованы при помощи указания соответствующих аргументов в декораторе функций:
```
@bot.message_handler(commands=['start'])
@bot.message_handler(commands=['help'])
```
Команда ```/start``` используется для начала работы с ботом. В реализации этой функции была также использована конструкция из TeleBot ```ReplyKeyboardMarkup```, которая реализует интеративные кнопки, показываемые в чате с ботом:

![image](https://user-images.githubusercontent.com/71255336/215343389-16a615a1-133c-46cc-8fc8-3a047d9661a6.png)

Далее, были использованы хэндлеры, которые также являются декораторами из TeleBot и используется для реагирования на поступающие от пользователя сообщения различных типов, будь то текст или изображения. Внутри хэндлеров реализована условная конструкция, позволяющая один и тот же хэндлер в зависимости от полученного сообщения выполнять различные действия.

После получения двух фотографий от пользователя бот скачивает и сохраняет их в локальной директории, чтобы затем передать их в нейронную сеть для дальнейшей обработке.

## Neural Net

Для удобной работы с нейронными сетями были использованы следующие модули: [pytorch](https://pytorch.org/docs/stable/index.html), [torchvision](https://pytorch.org/vision/stable/), [PIL](https://pypi.org/project/Pillow/), [matplotlib](https://matplotlib.org/)
В качестве основы для нейронной сети была взята предобученная на датасете ImageNet сверточная сеть VGG19, взятая из модуля torchvision.models.
При попадании изображений в сеть происходит предобработка: они обрезаются и приводятся к тензорам.
Далее, можно ознакомиться со слоями, которые использовались при написании архитектуры сети

### Normalization

Даннный слой был использован лишь для одной цели: нормировка входных данных в соответствии с нормировачными данными сети VGG19
